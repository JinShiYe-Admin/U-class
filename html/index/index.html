<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>主页</title>
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<style>
			.mui-bar {
				box-shadow: none;
			}
		</style>
	</head>

	<body>
		<nav class="mui-bar mui-bar-tab">
			<a class="mui-tab-item mui-active" href="u-home.html">
				<span class="mui-icon mui-icon-home"></span>
				<span class="mui-tab-label">优课</span>
			</a>
			<a class="mui-tab-item" href="source-home.html">
				<span class="mui-icon mui-icon-email"></span>
				<span class="mui-tab-label">资源</span>
			</a>
			<a class="mui-tab-item" href="ani-home.html">
				<span class="mui-icon mui-icon-contact"></span>
				<span class="mui-tab-label">动画课</span>
			</a>
		</nav>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/utils/utils.js"></script>
		<script src="../../js/common/publicProtocol.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">
			//页面路径
			var subPages = ['../u-class/u-home.html', '../sourse/source-home.html', '../animation-class/ani-home.html'];
			var aniShow = {}; //记录是否显示过页面
			var activeTab = "u-home.html"; //当前激活的页面id
			var main; //当前webview
			mui.init();
			mui.plusReady(function() {
				getProvinceList();
				initListener();
				initSubPage();
				utils.preloadWebWithData("../utils/download.html"); //预加载下载页
			});

			/**
			 * 初始化监听
			 */
			function initListener() {
				//选项卡点击事件
				mui('.mui-bar-tab').on('tap', 'a', function(e) {
					var targetTab = this.getAttribute('href');
					if(targetTab == activeTab) {
						return;
					}
					//若为iOS平台或非首次显示，则直接显示
					if(mui.os.ios || aniShow[targetTab]) {
						plus.webview.show(targetTab);
					} else {
						//否则，使用fade-in动画，且保存变量
						var temp = {};
						temp[targetTab] = "true";
						mui.extend(aniShow, temp);
						plus.webview.show(targetTab, "fade-in", 300);
					}
					//隐藏当前;
					plus.webview.hide(activeTab);
					//更改当前活跃的选项卡
					activeTab = targetTab;
				});
			}

			/**
			 * 初始化子页面
			 */
			function initSubPage() {
				main = plus.webview.currentWebview();
				//创建子页面，首个选项卡页面显示，其它均隐藏；
				for(var i in subPages) {
					var temp = {};
					var subPage_Id = utils.getWebUrlId(subPages[i]);
					var subpage_style = utils.getWebStyle(subPage_Id);
					subpage_style.bottom = "50px";
					var subPage = plus.webview.create(subPages[i], subPage_Id, subpage_style);
					if(i > 0) {
						subPage.hide();
					} else {
						temp[subPage_Id] = "true";
						mui.extend(aniShow, temp);
					}
					main.append(subPage);
				}
			}
			mui('body').on('tap', '.mui-bar', function() {
				var page = plus.webview.getWebviewById('u-home.html');
				//触发目标页面的listener事件
				mui.fire(page, 'toUHome', {
					data: ''
				});
				page = plus.webview.getWebviewById('source-home.html');
				//触发目标页面的listener事件
				mui.fire(page, 'toUHome', {
					data: ''
				});
				page = plus.webview.getWebviewById('ani-home.html');
				//触发目标页面的listener事件
				mui.fire(page, 'toUHome', {
					data: ''
				});
			});

			function getProvinceList() {
				//1、省份列表
				var commonData = {}
				postDataPro_provinceList(commonData,function(data){
					var info = {
						data:data.data,
						currentPro:data.data[0]
					}
					window.myStorage.setItem('provinceInfo', info);
				});
				//5、获取资源的分类及子分类
				postDataPro_rescatList({}, function(data) {
					if (data.code == 0) {
						//将获取到的数据，保存到本地，方便别的页面调用
						window.myStorage.setItem(window.storageKeyName.RESOURCELIST, data.data);
					}
				});
			}
		</script>
	</body>

</html>